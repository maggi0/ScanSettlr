<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:controls="clr-namespace:ScanSettlr.Controls"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="ScanSettlr.AddUsersPage"
             x:Name="AddUsers"
             BackgroundColor="#218CA1">

    <Grid RowDefinitions="Auto,*">
        <!-- Top bar -->
        <controls:TopBar Title="Users"
                         ShowSettingsButton="False"/>

        <ScrollView Grid.Row="1">
            <VerticalStackLayout Padding="40">

                <Label Text="Add users:"
                       Padding="5"
                       TextColor="White"/>
                <Border Stroke="Black">
                    <Border.StrokeShape>
                        <RoundRectangle CornerRadius="5"></RoundRectangle>
                    </Border.StrokeShape>
                    <SearchBar Placeholder="Search users..." 
                               Text="{Binding SearchQuery, Mode=TwoWay}" 
                               SearchCommand="{Binding SearchCommand}"
                               BackgroundColor="White" />
                </Border>

                <!-- List of search results -->
                <Border>
                    <Border.StrokeShape>
                        <RoundRectangle CornerRadius="5"></RoundRectangle>
                    </Border.StrokeShape>
                    <CollectionView ItemsSource="{Binding SearchResults}"
                                BackgroundColor="White"
                                SelectionMode="Multiple"
                                SelectionChanged="OnSelectionChanged">
                        <CollectionView.ItemTemplate>
                            <DataTemplate>
                                <Border Stroke="Black">
                                    <Label Padding="5" Text="{Binding username}" FontSize="16" />
                                </Border>
                            </DataTemplate>
                        </CollectionView.ItemTemplate>
                    </CollectionView>
                </Border>


                <!-- Add button -->
                <Button Text="Add Selected Users"
                    Command="{Binding AddUsersCommand}"
                    Margin="0,10,0,0"
                    BackgroundColor="#16606E"
                    TextColor="White" />

                <Border
                    Margin="0,50,0,0"
                    Stroke="Black"
                    BackgroundColor="#16606E">
                    <Border.StrokeShape>
                        <RoundRectangle CornerRadius="20,20,0,0" />
                    </Border.StrokeShape>
                    <Label
                        Text="Users"
                        TextColor="White"
                        FontSize="20"
                        FontFamily="Roboto"
                        HorizontalTextAlignment="Center">
                    </Label>
                </Border>
                <CollectionView ItemsSource="{Binding Users}">
                    <CollectionView.ItemTemplate>
                        <DataTemplate>
                            <Grid ColumnDefinitions="*,50" HeightRequest="50">
                                <Border Stroke="Black" BackgroundColor="#BDF4F8">
                                    <Border.StrokeShape>
                                        <RoundRectangle CornerRadius="0" />
                                    </Border.StrokeShape>
                                    <Label
                                    Text="{Binding username}"
                                    BackgroundColor="Transparent"
                                    TextColor="Black"
                                    VerticalTextAlignment="Center"
                                    HorizontalTextAlignment="Center" />
                                </Border>
                                <Border Grid.Column="1" Stroke="Black" BackgroundColor="#E26B54">
                                    <Border.StrokeShape>
                                        <RoundRectangle CornerRadius="0" />
                                    </Border.StrokeShape>
                                    <Button BackgroundColor="Transparent"
                                            Text="x"
                                            TextColor="Black"
                                            FontSize="16"
                                            Command="{Binding BindingContext.RemoveUserCommand, Source={x:Reference AddUsers}}"
                                            CommandParameter="{Binding .}">
                                    </Button>
                                </Border>
                            </Grid>
                        </DataTemplate>
                    </CollectionView.ItemTemplate>
                </CollectionView>
                
            </VerticalStackLayout>
        </ScrollView>
    </Grid>
</ContentPage>
